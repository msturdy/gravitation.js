/*! gravitation.js 2015-04-12 */
function Bullet(a,b){this.x=a.x,this.y=a.y,this.speed=25,this.dirn=b,this.draw=function(){ctx.fillRect(this.x,this.y,5,5)},this.move=function(){this.x=this.x+Math.cos(this.dirn)*this.speed,this.y=this.y+Math.sin(this.dirn)*this.speed},this.update=function(){this.move(),this.draw()}}function Ship(a,b){this.x=a.x,this.y=a.y,this.speed=0,this.acceleration=.1,this.top_speed=20,this.braking=.8,this.dirn=0,this.draw=function(){var a=this.x+15*Math.cos(this.dirn),c=this.y+15*Math.sin(this.dirn),d=this.x+8*Math.cos(this.dirn+Math.PI*(9/16)),e=this.y+8*Math.sin(this.dirn+Math.PI*(9/16)),f=this.x+8*Math.cos(this.dirn-Math.PI*(9/16)),g=this.y+8*Math.sin(this.dirn-Math.PI*(9/16));b.beginPath(),b.moveTo(a,c),b.lineTo(d,e),b.lineTo(f,g),b.lineTo(a,c),b.stroke()},this.move=function(){var a=this.x+Math.cos(this.dirn)*this.speed,c=this.y+Math.sin(this.dirn)*this.speed;a>15&&a<b.canvas.width-15&&(this.x=a),c>15&&c<b.canvas.height-15&&(this.y=c)},this.fire=function(){var a={x:this.x,y:this.y};game.bullets.push(new Bullet(a,this.dirn))},this.accelerate=function(){this.speed<=this.top_speed&&(this.speed=this.speed+this.acceleration)},this.brake=function(){this.speed>0&&(this.speed=this.speed-this.braking,this.speed<0&&(this.speed=0))},this.update=function(){this.move(),this.draw(),document.getElementById("ship-speed").innerHTML=this.speed,document.getElementById("ship-x").innerHTML=Math.floor(this.x),document.getElementById("ship-y").innerHTML=Math.floor(this.y)}}var levels={1:[],2:[]},Input={setup:function(){document.addEventListener("keydown",function(a){37==a.keyCode?game.events.push("left"):39==a.keyCode?game.events.push("right"):38==a.keyCode?game.events.push("thrust"):40==a.keyCode?game.events.push("brake"):32==a.keyCode?game.events.push("space"):81==a.keyCode?game.events.push("stop"):console.log("button pressed: "+a.keyCode)})},handle:function(){var a=[];if(game.events.length>0)for(var b=0;b<game.events.length;b++)a.push(game.events.pop(b));a.forEach(function(a){var b=game.ships[0];"space"===a?b.fire():"left"===a?b.dirn=b.dirn-.25:"right"===a?b.dirn=b.dirn+.25:"thrust"===a?b.accelerate():"brake"===a?b.brake():"stop"===a&&(b.speed=0)})}},Game={ships:[],bullets:[],events:[],init:function(a){return this.ctx=a,console.log("Game started"),Input.setup(),this.ships.push(new Ship({x:Math.floor(Math.random()*(a.canvas.width-50-50)+50),y:Math.floor(Math.random()*(a.canvas.height-50-50)+50)},this.ctx)),console.log("Ships added"),console.log(this.ships),this},update:function(){var a=window.game;Input.handle(),this.ctx.clearRect(0,0,750,500),a.ships.forEach(function(a){a.update()}),a.bullets.forEach(function(b,c){b.update(),(b.x<0||b.y<0||b.x>this.ctx.height||b.y>this.ctx.width)&&a.bullets.splice(c,1)}),window.requestAnimationFrame(a.update)}},canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),game=Game.init(ctx);window.requestAnimationFrame(game.update);